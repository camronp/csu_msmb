---
title: "Exercise_5.1"
author5.1: "Camron Pearce"
date: "3/12/2020"
output: html_document
categories:
  - exercises
  - Chapter 5
tags:
  - exercises
  - Chapter 5
---


```{r setup, include=FALSE, echo=TRUE}
knitr::opts_chunk$set(echo = TRUE)
```
This document contains the solution and supplemental code for exercise 5.1.

# Required Libraries
```{r, error=FALSE, message=FALSE}
library("cluster")
library(dplyr)
library(ggplot2)
library(purrr)
```

# 5.1A

5.7 Code for Exercise Setup

```{r, echo=TRUE, message=FALSE, include=TRUE}
set.seed(1)

simdat = lapply(c(0, 8), function(mx) {
  lapply(c(0,8), function(my) {
    tibble(x = rnorm(100, mean = mx, sd = 2),
           y = rnorm(100, mean = my, sd = 2),
           class = paste(mx, my, sep = ":"))
   }) %>% bind_rows
}) %>% bind_rows

simdatxy = simdat[, c("x", "y")]

wss = tibble(k = 1:8, value = NA_real_)

wss$value[1] = sum(scale(simdatxy, scale = FALSE)^2)

for (i in 2:nrow(wss)) {
  km  = kmeans(simdatxy, centers = wss$k[i])
  wss$value[i] = sum(km$withinss)
}

ggplot(wss, aes(x = k, y = value)) + geom_col()

pam4 = pam(simdatxy, 4)
sil = silhouette(pam4, 4)
plot(sil, col=c("red","green","blue","purple"), main="Silhouette")

```

Computing the Silhouette Index

```{r}
summary(sil)$avg.width
```

# 5.1B

There seem to be a couple of ways to assess which k gives the best silhouette index. 

One method would be trial and error and determining which k-value produces the highest silhouette index.
```{r}
pam2 = pam(simdatxy, 2)
sil2 = silhouette(pam2, 2)
plot(sil2, col=c("red","green","blue","purple"), main="Silhouette")

pam3 = pam(simdatxy, 3)
sil3 = silhouette(pam3, 3)
plot(sil3, col=c("red","green","blue","purple"), main="Silhouette")

pam4 = pam(simdatxy, 4)
sil = silhouette(pam4, 4)
plot(sil, col=c("red","green","blue","purple"), main="Silhouette")

pam12 = pam(simdatxy, 12)
sil12 = silhouette(pam12, 12)
plot(sil12, col=c("red","green","blue","purple"), main="Silhouette")

pam40 = pam(simdatxy, 40)
sil40 = silhouette(pam40, 40)
plot(sil40, col=c("red","green","blue","purple"), main="Silhouette")
```

The trial and error method indicates that the highest silhouette index is achieved with k = 4.

Another (seemingly more appropriate) method is to write code that will test different k-values for you. This next piece of code is directly from Amy Fox and the group that she worked with during class.

```{r}
k <- c(2:10)
df_test <- data.frame()
for (i in 2:10){
  
  pam_run <- pam(simdatxy, i)
  sil_run <- silhouette(pam_run, i)
  
  row_to_add <- data.frame(i, width = summary(sil_run)$avg.width)
  
  df_test <- rbind(df_test, row_to_add)
}
df_test
ggplot(df_test, aes(i, width)) +
  geom_point() +
  geom_line() +
  xlab("k") +
  ylab("Silhouette Index") +
  ggtitle("Testing different k values for Silhouette Index")
summary(sil_run)
```

This method removes any manual trial and error, and clearly demonstrates that a k = 4 provides us with the highest silhouette index.

# 5.1C

Repeating with uniform data.

```{r}
set.seed(1)

simdat1 = lapply(c(1), function(mx) {
  lapply(c(1), function(my) {
    tibble(x = rnorm(100, mean = mx, sd = 2),
           y = rnorm(100, mean = my, sd = 2),
           class = paste(mx, my, sep = ":"))
   }) %>% bind_rows
}) %>% bind_rows

simdatxy1 = simdat1[, c("x", "y")]

ggplot(simdatxy1, aes(x = x, y = y)) +
  geom_point()

pam4.1 = pam(simdatxy1, 4)
sil.1 = silhouette(pam4.1, 4)
plot(sil.1, col=c("red","green","blue","purple"), main="Silhouette")

```

The average silhouette width is 0.33, which is much lower than the clustered value of 0.50 that we see with the first simulation.
